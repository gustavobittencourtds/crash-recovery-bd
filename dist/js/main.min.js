dashboard={diskData:[{id:1,nome:"Maria",salario:2e3,salvo:"Sim"},{id:2,nome:"Carlos",salario:1500,salvo:"Sim"},{id:3,nome:"Paola",salario:2200,salvo:"Sim"},{id:4,nome:"Emília",salario:1800,salvo:"Sim"},{id:5,nome:"Otávio",salario:1400,salvo:"Sim"}],diskDataTemporary:[],logMemoryData:[],bufferMemoryData:[],logDisk:[],undoTransactions:[],redoTransactions:[],insertTable:function(a,e,o){const r=[...o.reduce((e,a)=>(Object.keys(a).forEach(a=>e.add(a)),e),new Set)];var t=r.map(a=>`<th>${a}</th>`).join(""),o=o.map(e=>r.map(a=>`<td>${e[a]}</td>`).join("")).map(a=>`<tr>${a}</tr>`).join("");a.innerHTML=`<table><caption class="title">${e}</caption><thead><tr>${t}</tr></thead> <tbody>${o}</body></table>`},executeTransaction:function(){const a=document.querySelectorAll("[data-transaction]"),l=document.querySelector("[data-memory-log]"),u=document.querySelector("[data-memory-buffer]");dashboard.diskDataTemporary=dashboard.diskData,0<a.length&&a.forEach(i=>{const n=i.querySelector(".sql"),a=(n.addEventListener("submit",a=>{a.preventDefault();const e=n.querySelector('input[name="where"]')?.value,o=n.querySelector('input[name="comparison"]')?.value,r=Number(n.querySelector('input[name="set_value"]')?.value),t=dashboard.diskData.find(a=>a[e]==o),s=t.salario,d={...t,salario:r,salvo:"Não"};a={Transaction:"Transação "+n.querySelector('input[name="transaction_number"]').value,Tabela:"Funcionário",Linha:o,Atributo:"Salário",Antes:s,Depois:r,Status:"Início"};dashboard.logMemoryData.push(a),dashboard.bufferMemoryData.push(d),this.insertTable(l,"Memória - Buffer LOG",dashboard.logMemoryData),this.insertTable(u,"Memória - Buffer Dados",dashboard.bufferMemoryData)}),i.querySelector("[data-commit]"));a.addEventListener("click",a=>{const e=i.querySelector('input[name="comparison"]').value,o=Number(n.querySelector('input[name="set_value"]').value);i.dataset.transaction="Fim";var r=dashboard.logMemoryData.map(a=>a.Transaction==i.dataset.name?{...a,Status:"Finalizada"}:a),t=dashboard.bufferMemoryData.map(a=>a.id==e?{...a,salvo:"Sim"}:a),s=dashboard.diskData.map(a=>a.id==e?{...a,salario:o}:a),d=dashboard.diskData.map(a=>a.id==e?{...a,salario:o}:a);dashboard.logMemoryData=r,dashboard.bufferMemoryData=t,dashboard.diskData=d,dashboard.diskDataTemporary=s,this.insertTable(l,"Memória - Buffer LOG",dashboard.logMemoryData),this.insertTable(u,"Memória - Buffer Dados",dashboard.bufferMemoryData)})})},checkpoint:function(){const r=this,a=document.querySelector("[data-checkpoint]");a.addEventListener("click",()=>{var a=document.querySelector("[data-disk]"),e=document.querySelector("[data-disk-data]"),o=document.querySelector("[data-memory-log]"),o=(dashboard.logMemoryData.push({Transaction:"Checkpoint",Tabela:"-",Linha:"-",Atributo:"-",Antes:"-",Depois:"-",Status:"-"}),this.insertTable(o,"Memória - Buffer LOG",dashboard.logMemoryData),dashboard.logDisk=dashboard.logMemoryData,r.insertTable(a,"Disco - LOG",dashboard.logDisk),dashboard.logMemoryData.map(a=>{"-"!=a.Status&&("Início"==a.Status?dashboard.undoTransactions.push(a):a.Status="C - Finalizada")}),dashboard.diskDataTemporary.map(e=>{var a=dashboard.bufferMemoryData.find(a=>a.id===e.id);return a||e}));dashboard.diskDataTemporary=o,r.insertTable(e,"Disco - Dados",dashboard.diskDataTemporary)})},simulateFailures:function(){const a=document.querySelector(".dashboard"),e=document.querySelector("[data-error]");e.addEventListener("click",()=>{a.classList.add("-failure")})},recovery:function(){const a=document.querySelector("[data-recovery]"),e=document.querySelector(".dashboard"),o=document.querySelector("[data-disk-data]"),r=document.querySelector("[data-disk]"),t=document.querySelector("[data-memory-log]"),s=document.querySelector("[data-memory-buffer]");a.addEventListener("click",()=>{dashboard.logMemoryData.map(a=>{"-"!=a.Status&&"Finalizada"==a.Status&&dashboard.redoTransactions.push(a)}),console.log("Desfazer: ",dashboard.undoTransactions),console.log("Refazer: ",dashboard.redoTransactions);var a={Transaction:"-",Tabela:"-",Linha:"-",Atributo:"-",Antes:"-",Depois:"-",Status:"-"};dashboard.logMemoryData=[],dashboard.logMemoryData.push(a),dashboard.logDisk=[],dashboard.logDisk.push(a),dashboard.bufferMemoryData=[],dashboard.bufferMemoryData.push({id:"-",nome:"-",salario:"-",salvo:"-"}),this.insertTable(t,"Memória - Buffer LOG",dashboard.logMemoryData),this.insertTable(r,"Disco - LOG",dashboard.logDisk),this.insertTable(s,"Memória - Buffer Dados",dashboard.bufferMemoryData),e.classList.remove("-failure"),this.insertTable(o,"Disco - Dados",dashboard.diskData),dashboard.diskDataTemporary=dashboard.diskData})},init:function(){var a=document.querySelector("[data-disk-data]");this.insertTable(a,"Disco - Dados",dashboard.diskData),this.executeTransaction(),this.checkpoint(),this.simulateFailures(),this.recovery()}},window.addEventListener("DOMContentLoaded",()=>{dashboard.init()});